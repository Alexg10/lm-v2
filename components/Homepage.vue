<template>
        <div class="homepage-container">
            <div class="swiper-slide love-container">
                <div class="home-slide-content red">
                    <div class="bg-love">
                        <img class="bg-love-cover cover-1 visible" src="/images/home/lm_22.png" alt="">
                        <img class="bg-love-cover cover-2" src="/images/home/lm_1.jpg" alt="">
                        <img class="bg-love-cover cover-3" src="/images/home/lm_33.png" alt="">
                        <img class="bg-love-cover cover-4" src="/images/home/lm_44.png" alt="">
                        <img class="bg-love-cover cover-5" src="/images/home/lm_55.png" alt="">
                    </div>
                    <LoveContent/>
                    <div class="word-container " v-on:mouseenter="loveHover" v-on:mouseleave="loveLeave" v-on:click="loveClick">
                        <div class="word-wrapper word-wrapper-elle">
                            <div class="word elle">
                                <span class="hide">
                                    <div class="hide-right">el</div>
                                </span>
                                <span class="hide">l</span>
                                <span class="hide">
                                    <div class="hide-left">e</div>
                                </span>
                            </div>
                        </div>
                        <div class="word-wrapper word-wrapper-aime">
                            <div class="word aime">
                                <span class="hide">
                                    <div class="hide-right">ai</div>
                                </span>
                                <span class="hide">m</span>
                                <span class="hide">
                                    <div class="hide-left">e</div>
                                </span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="swiper-slide work-container">
                <div class="home-slide-content orange">
                    <nuxt-link to="project">
                        <div class="word-container" v-on:mouseenter="workHover" v-on:mouseleave="particuleAnimLeave"  v-on:click="workClick" >
                            <div class="word-wrapper word-wrapper-work" >
                                <span class="word work">work</span>
                            </div>
                            <div class="word-wrapper word-wrapper-work">
                                <span class="word work">work</span>
                            </div>
                            <div class="word-wrapper word-wrapper-work">
                                <span class="word work">work</span>
                            </div>
                        </div>
                    </nuxt-link>
                </div>
            </div>
        </div>
</template>

<script>
    import gsap from "gsap"
    import LoveContent from '~/components/project/LoveContent.vue'

    export default {
        components:{
            LoveContent
        },
        data(){
            return{
                coverIndex     : 1,
                playing        : '',
                scrollable     : true,
                LoveClickTl    : gsap.timeline({paused: true}),
                workClickTl    : gsap.timeline({paused: true}),
                loveInit       : gsap.timeline(),
                loveUp         : gsap.timeline(),
                loveUpR        : gsap.timeline(),
                loveUpUp       : gsap.timeline({paused: true}),
                loveDown       : gsap.timeline(),
                loveDownDown   : gsap.timeline(),
                workUp         : gsap.timeline({progress: 1}),
                workUpUp       : gsap.timeline({progress: 1}),
                workDownDown   : gsap.timeline({progress: 1}),
                workDown       : gsap.timeline({progress: 1}),
                loveShowContent: gsap.timeline({paused: true})
            }
        },

        methods: {
            scrollUp(){
                var vm = this;
                vm.scrollable = false;
                if( !document.querySelector('.work-container').classList.contains('visible') ){
                    document.querySelector('.work-container').classList.add("visible");
                    console.log('UP FROM LOVE ');
                    vm.loveDown.pause(0);
                    vm.loveDown.play();
                    vm.loveDown.eventCallback("onComplete", function () {
                        vm.workDownDown.pause(0);
                        vm.workDownDown.play();
                    });
                }else{
                    console.log('UP FROM WORK ')
                    vm.workDown.pause(0);
                    vm.workDown.play();
                    vm.workDown.eventCallback("onComplete", function () {
                        document.querySelector('.work-container').classList.remove("visible");
                        vm.loveDownDown.pause(0);
                        vm.loveDownDown.play();
                    });
                }
                setTimeout(() => {
                    vm.scrollable = true;
                }, 1500);
            },
            scrollDown(){
                var vm = this;
                vm.scrollable = false;
                if( document.querySelector('.work-container').classList.contains('visible') ){
                    console.log('Down FROM Work ');
                    vm.workUpUp.time(0);
                    vm.workUpUp.play();
                    vm.workUpUp.eventCallback("onComplete", function () {
                        document.querySelector('.work-container').classList.remove("visible");
                        vm.loveUpR.pause(0);
                        vm.loveUpR.play();
                    });
                }else{
                    document.querySelector('.work-container').classList.add("visible");
                    console.log('Down FROM LOVE ');
                    vm.loveUpUp.pause(0);
                    vm.loveUpUp.play();
                    vm.loveUpUp.eventCallback("onComplete", function () {
                        vm.workUp.pause(0);
                        vm.workUp.play();
                    });
                }
                setTimeout(() => {
                    vm.scrollable = true;
                }, 1500);
            },
            scrollSlide(){
                var vm = this;
                window.addEventListener('wheel', function(e) {
                    if (e.deltaY < 0 && vm.scrollable) {
                        vm.scrollUp();
                    }
                    if (e.deltaY > 0 && vm.scrollable) {
                        vm.scrollDown()
                    }
                });
            },
            keySlide(e) {
                var vm = this;
                document.onkeydown = function(e){
                    e = e || window.event;
                    if (e.keyCode == '38') {
                        vm.scrollUp();
                    }
                    else if (e.keyCode == '40') {
                        vm.scrollDown();
                    }
                    else if (e.keyCode == '37') {
                        vm.scrollUp();
                    }
                    else if (e.keyCode == '39') {
                        vm.scrollDown();
                    }
                }
            },
            loveHover(){
                document.querySelector('.cursor-fx__inner__outside').classList.add('hover');
                document.querySelector('.bg-love').classList.add("visible");
                this.playing = setInterval(() => {
                    this.gif();
                }, 250)
            },
            loveLeave(){
                document.querySelector('.bg-love').classList.remove("visible");
                clearInterval(this.playing);
                document.querySelector('.cursor-fx__inner__outside').classList.remove('hover');
            },
            loveClick(){
                document.querySelector('.word-container').classList.add("clicked");
                this.LoveClickTl.pause(0);
                this.loveShowContent.pause(0);
                this.LoveClickTl.play();
                this.LoveClickTl.eventCallback("onComplete", function () {
                    document.querySelector('.love-content').classList.add("visible");
                });
                this.loveShowContent.play();
            },
            workHover(){
                this.particuleAnim()
            },
            workClick(){
                var vm=this;
                this.workClickTl.play();
                this.particuleAnimLeave();
                this.workClickTl.eventCallback("onComplete", function () {
                    vm.$router.push({
                        path: '/project/'
                    })
                });
            }, 

            gif(){
                const foo = document.querySelector('.bg-love');
                var gifLenght = foo.children.length;
                this.coverIndex++;
                var activeBg = document.querySelector('.cover-'+this.coverIndex);
                document.getElementsByClassName('bg-love-cover visible')[0].classList.remove("visible");
                activeBg.classList.add("visible");
                if(this.coverIndex >= foo.children.length){
                    this.coverIndex=0;
                }
            },
            particuleAnim(){
                function random(min, max) {
                    return Math.floor(Math.random() * (1 + max - min) + min);
                }
                var tlexplosion = gsap.timeline({});
                var num = 0;

                document.querySelector('.cursor-fx__inner__outside').classList.add('transparent');

                this.inter = window.setInterval(function () {
                    var typeParticule = random(1,12);
                    var div = document.createElement("div");
                    div.setAttribute("class", "sparkle part-" + num);
                    var particules = document.querySelector('.cursor-fx__inner__outside');
                    particules.appendChild(div);
                    var lastPart = document.querySelector(".part-" + num);
                    lastPart.classList.add("sparkle-"+typeParticule);
                    createDot(lastPart)
                    num++
                },100); 

                function createDot(elem){
                    gsap.fromTo(elem, {
                        left: "+=" + random(-20,20) + "px",
                        top: "+=" + random(-20,20) + "px",
                        z: 0,
                        opacity: 1
                    }, {
                        duration: 1.25,
                        left: "+=" + random(-200,200) + "px",
                        top: "+=" + random(-200,200) + "px",
                        z: "+=" + random(-725,600),
                        opacity: 0,
                        ease: "power4.inOut"
                    });
                }
            },
            particuleAnimLeave(){
                clearInterval(this.inter);
                document.querySelector('.cursor-fx__inner__outside').classList.remove('transparent');
                setTimeout(function(){
                    document.querySelectorAll('.sparkle').forEach(
                        e => e.remove()
                    );
                }, 1500)
            }
        },
        mounted() {
            this.loveShowContent
                .to({}, 2, {})
                .to(".love-content", {opacity:1, duration:1, ease: "power4.inOut" }, "loveShowContent")
                .from(".marquee-text-text", {opacity:0, duration:1, ease: "power4.inOut" }, "loveShowContent")
                .from(".love-description", {y: 20, opacity:0, duration: 1.8, ease: "power4.inOut" }, "loveShowContent+=0.5")
                .from(".infos-link a", {y: 50, duration:1, ease: "power4.inOut", stagger: 0.5 }, "loveShowContent+=1")
                .from(".developped-link", {y: 50, duration:1.5, ease: "power4.inOut" }, "loveShowContent+=1.7");

            this.loveShowContent.eventCallback("onComplete", function () {
                document.querySelector('.cross').classList.add("active");
            });

            this.LoveClickTl
            .to(".word-wrapper-elle", {x:"-80vw", duration: 1.75, repeatRefresh: true, ease: "power4.inOut" },"LoveClickTl")
            .to(".word-wrapper-aime", {x:"80vw", duration: 1.75, repeatRefresh: true, ease: "power4.inOut" },"LoveClickTl");

            this.workClickTl
                .to(".word-wrapper-work:nth-child(1)", {x:"80vw", duration: 2, ease: "power4.inOut" },"workClickTl")
                .to(".word-wrapper-work:nth-child(2)", {x:"-80vw", duration: 2, ease: "power4.inOut" },"workClickTl")
                .to(".word-wrapper-work:nth-child(3)", {x:"80vw", duration: 2, ease: "power4.inOut" },"workClickTl");

            this.loveUpUp
                .fromTo(".elle", {y: 0},{y:-170, duration: 1, repeatRefresh: true, ease: "power4.inOut" },"loveUpUp")
                .fromTo(".aime", {y: 0},{y:-170, duration: 1, repeatRefresh: true, ease: "power4.inOut"},"loveUpUp+=0.25");

            this.loveUp
                .fromTo(".elle", {y: 0},{y:-170, duration: 1, repeatRefresh: true, ease: "power4.inOut" },"loveUpUp")
                .fromTo(".aime", {y: 0},{y:-170, duration: 1, repeatRefresh: true, ease: "power4.inOut"},"loveUpUp+=0.25");

            this.loveUpR
                .fromTo(".elle", {y: 170},{y:0, duration: 1, repeatRefresh: true, ease: "power4.inOut" },"loveUpUp")
                .fromTo(".aime", {y: 170},{y:0, duration: 1, repeatRefresh: true, ease: "power4.inOut"},"loveUpUp+=0.25");

            this.loveDown
                .fromTo(".aime", {y:0},{y: 170, duration: 1, repeatRefresh: true, ease: "power4.inOut" },"lmUp")
                .fromTo(".elle", {y:0},{y: 170, duration: 1, repeatRefresh: true, ease: "power4.inOut"},"lmUp+=0.25");

            this.loveDownDown
                .fromTo(".aime", {y:-170},{y:0, duration: 1, repeatRefresh: true, ease: "power4.inOut"},"lmUp")
                .fromTo(".elle", {y:-170},{y:0, duration: 1, repeatRefresh: true, ease: "power4.inOut" },"lmUp+=0.25");

            this.workUp
                .fromTo(".work", {y:170}, {y: 0, duration: 1, ease: "power4.inOut", stagger:0.3 },"workInit");

            this.workUpUp
                .fromTo(".work", {y: 0},{y: -170, duration: 1, ease: "power4.inOut", stagger:0.3 },"workInit");

            this.workDownDown
                .fromTo(".work", {y: -170},{y: 0, duration: 1, ease: "power4.inOut", stagger:-0.3 },"workInit");

            this.workDown
                .fromTo(".work", {y: 0},{y: 170, duration: 1, ease: "power4.inOut", stagger:-0.3 },"workInit");

            this.scrollSlide();
            this.keySlide();
        }
    }
</script>

<style lang="scss" scoped>

    body{
        overflow: hidden;
    }

    .homepage-container{
        position: relative;
        overflow: hidden;
        .work-container{
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            &.visible{
                display: block;
            }
        }
    }
    a{
        text-decoration: none;
        color: black;
        transition: all 0.6s ease;
    }
    .swiper-container{
        height: 100vh;
    }
    .swiper-slide{
        width: 100vw;
        // height: 100%!important;
    }
    .bg-love{
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: green;
        opacity: 0;
        pointer-events: none;
        transition: all 0.9s cubic-bezier(.19,.77,.2,1);
        &.visible{
            opacity: 1;
            transition: all 0.9s cubic-bezier(.19,.77,.2,1);
        }
        img{
            width: 100%;
            height: 100vh;
            object-fit: cover;
            display: none;
            &.visible{
                display: block;
            }
        }
    }
    .home-slide-content{
        position: relative;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-size: 200px;
        text-align: center;
        font-weight: bold;
        // background: white;
        @media ( max-width : 680px ) {
            font-size: 130px;
        }
        // &.red{
        //     background-color: red;
        // }
        // &.orange{
        //     background-color: orange;
        // }
        .word-container{
            display: block;
            cursor: none!important;

            &:hover{
                cursor: pointer;
                .word,
                a{
                    color: #FF9170;
                    transition: all 0.9s cubic-bezier(.19,.77,.2,1);
                }
                .hide{
                    color: #FF9170;
                    transition: all 0.9s cubic-bezier(.19,.77,.2,1);
                    .hide-right,
                    .hide-left{
                        color: #FF9170;
                        transform: translateX(0);
                        opacity: 1;
                        transition: all 0.9s cubic-bezier(.19,.77,.2,1);
                    }
                }
                //ELLE AIME
                .word-wrapper{
                    &-elle{
                        left: -79px;
                        transition: all 0.9s cubic-bezier(.19,.77,.2,1);
                    }
                    &-aime{
                        left: 125px;
                        transition: all 0.9s cubic-bezier(.19,.77,.2,1);
                    }
                }
                .elle{
                    color: #FF9170;
                    transition: color 0.9s cubic-bezier(.19,.77,.2,1);
                }
                .aime{
                    color: #FF9170;
                    transition: color 0.9s cubic-bezier(.19,.77,.2,1);
                }

                //WORK
                .word-wrapper-work{
                    transition: all 1.05s cubic-bezier(.19,.77,.2,1);
                    &:nth-child(1){
                        position: relative;
                        left: 107px;
                    }
                    &:nth-child(2){
                        position: relative;
                        left: -22px;
                    }
                    &:nth-child(3){
                        position: relative;
                        left: 182px;
                    }
                }
            }
            &.clicked{
                .elle{
                    // left: -79px;
                    // transform: translateX(-80vh);
                    // transition: all 2s cubic-bezier(.19,.77,.2,1);

                }
                .aime{
                    // transform: translateX(80vh);
                    // left: 125px;
                    // transition: all 2s cubic-bezier(.19,.77,.2,1);

                }
                .hide{
                    .hide-right,
                    .hide-left{
                        opacity: 1;
                        transform: translateX(0);
                    }
                }
            }

            .word{
                display: flex;
                line-height: 160px;
                color: black;
            }
            .hide{
                width: auto;
                overflow: hidden;
                display: inline-block;
                color: black;
                transition: all 1.4s cubic-bezier(.19,.77,.2,1);
                .hide-right{
                    color: black;
                    transform: translateX(100%);
                    opacity: 0;
                    transition: all 1.4s cubic-bezier(.19,.77,.2,1);
                }
                .hide-left{
                    color: black;
                    transform: translateX(-100%);
                    opacity: 0;
                    transition: all 1.4s cubic-bezier(.19,.77,.2,1);
                }
            }
            .word-wrapper{
                overflow: hidden;
                &-elle{
                    position: relative;
                    bottom: -38px;
                    left: -37px;
                    transition: all 0.9s cubic-bezier(.19,.77,.2,1);
                    @media ( max-width : 680px ) {
                        bottom: -48px;
                        left: -27px;
                    }
                }
                &-aime{
                    position: relative;
                    top: -39px;
                    left: 9px;
                    transition: all 0.9s cubic-bezier(.19,.77,.2,1);
                    @media ( max-width : 680px ) {
                        top: -58px;
                        left: 3px;
                    }
                }
            }
            //ELLE AIME

            //WORK
            .word-wrapper-work{
                transition: all 1.1s cubic-bezier(.19,.77,.2,1);
                &:nth-child(1){
                    position: relative;
                    bottom: -77px;
                    left: 27px;
                    @media ( max-width : 680px ) {
                        bottom: -106px;
                        left: 0px;
                    }
                }
                &:nth-child(2){
                    position: relative;
                    left: 155px;
                    @media ( max-width : 680px ) {
                        left: 71px;
                    }
                }
                &:nth-child(3){
                    position: relative;
                    top: -73px;
                    left: -79px;
                    @media ( max-width : 680px ) {
                        top: -99px;
                        left: -82px;
                    }
                }
            }
        }
    }
</style>